<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI Song Re-Composer 360° — Frontend</title>
<style>
  :root {
    --bg:#194a6d; 
    --card:#eef0f1; 
    --muted:#c4cfe0; 
    --accent:#703f7c; 
    --glass: rgba(171, 128, 128, 0.04);
    --radius:14px; 
    --gap:16px; 
    font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
  }

  html,body {
    height:100%;
    margin:0;
    background:linear-gradient(180deg,#265380 0%, #2b557f 100%);
    color:#f6f7f9;
    animation: fadeIn 0.8s ease both;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .wrap {
    max-width:1100px;
    margin:28px auto;
    padding:20px;
  }
  header {
    display:flex;
    align-items:center;
    gap:16px;
  }
  h1 {
    font-size:20px;
    margin:0;
  }
  .logo {
    width:56px;
    height:56px;
    border-radius:14px;
    background:linear-gradient(135deg,#9f2a9f, #3aeded);
    position: relative;
    overflow: hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    color:rgb(253, 252, 252);
  }
  .logo::after {
    content:"";
    position:absolute;
    top:0;
    left:-100%;
    width:60%;
    height:100%;
    background:linear-gradient(120deg,transparent,rgba(184, 148, 148, 0.5),transparent);
    animation: shimmer 3s ease-in-out infinite;
  }
  @keyframes shimmer {
    0% { left:-100%; }
    60% { left:120%; }
    100% { left:120%; }
  }

  .grid {
    display:grid;
    grid-template-columns:1fr 420px;
    gap:20px;
    margin-top:18px;
  }
  @media (max-width:980px){.grid{grid-template-columns:1fr;}}

  /* 💳 Card */
  .card {
    padding: 10px;
    border-radius: 20px;
    background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.08);
    display: flex;
    flex-direction: column;
    gap: 14px;
    align-items: center;
    text-align: center;
    box-shadow: 0 8px 25px rgba(0,0,0,0.25);
    transition: transform .3s ease, box-shadow .3s ease;
  }
  .card:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: 0 15px 40px rgba(124,58,237,0.3);
  }
  .card label {
    font-size: 14px;
    color: #aab6c4;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 600;
  }

  /* Custom Upload */
  .custom-upload {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 14px;
  }
  .custom-upload input[type="file"] { display: none; }
  #uploadBtn {
    background: linear-gradient(135deg, #06b6d4, #7c3aed);
    border: none;
    padding: 10px 16px;
    border-radius: 12px;
    color: #afb1b1;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.3s, box-shadow 0.3s;
  }
  #uploadBtn:hover {
    transform: scale(1.08);
    box-shadow: 0 6px 14px rgba(124, 58, 237, 0.5);
  }
  #fileName {
    color: var(--muted);
    font-style: italic;
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
#styleSelect {
  padding: 10px 15px;
  border-radius: 10px;
  border: 2px solid #555;
  background: #f7f9fa;
  color: #989595;
  transition: 0.3s;
}

#styleSelect:hover {
  border-color: #38e2f8;
  box-shadow: 0 0 10px #38d5f8;
}

#styleSelect:focus {
  border-color: #f887c1;
  box-shadow: 0 0 15px #f688c1;
}

label[for="styleSelect"] {
  display: block;
  margin-bottom: 5px;
  color: #e2e8f0;
  font-size: 0.9rem;
}



  /* 🎵 Visualizer */
  #visualizer {
    width:100%;
    max-width:500px;
    height:200px;
    border-radius:10px;
    background: linear-gradient(270deg, #06b6d4, #7c3aed, #f472b6, #06b6d4);
    background-size: 400% 400%;
    border: 1px solid rgba(255,255,255,0.05);
    box-shadow: 0 0 100px rgba(236,72,153,0.2);
    animation: gradientFlow 6s ease infinite, pulseGlow 2.5s ease-in-out infinite;
    position: relative;
    overflow: hidden;
  }
  @keyframes gradientFlow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  @keyframes pulseGlow {
    0%, 100% { opacity: 0.4; box-shadow: 0 0 15px rgba(124,58,237,0.3); }
    50% { opacity: 1; box-shadow: 0 0 35px rgba(6,182,212,0.5); }
  }
  #generateBtn, #downloadBtn {
  background: #3b82f6;
  color: #fff;
  border: none;
  padding: 10px 18px;
  border-radius: 6px;
  transition: 0.2s;
}

#generateBtn:hover, #downloadBtn:hover {
  transform: scale(1.1);
}

#downloadBtn:disabled {
  opacity: 0.5;
}


  /* Buttons */
  button { cursor:pointer; border-radius:14px; padding:14px 30px; font-weight:600; transition:.3s; }
  #recordBtn.secondary { background: linear-gradient(135deg, #06b6d4, #7c3aed); color:#bac1c7; box-shadow: 0 4px 10px rgba(187, 180, 199, 0.3); }
  #recordBtn.secondary:hover { transform: scale(1.08); box-shadow: 0 6px 14px rgba(6,182,212,0.5); }
  #generateBtn { background: linear-gradient(135deg, #7c3aed, #06b6d4); color:#bdc3c4; }
  #downloadBtn.secondary { background: linear-gradient(135deg, #3b82f6, #34d399); color:#e4dcdc; }

  /* Poster */
  .poster {
    width: 100%;
    max-width: 260px;
    aspect-ratio: 1/1;
    border-radius: 18px;
    overflow: hidden;
    position: relative;
    border: 2px solid rgba(255,255,255,0.1);
    background: rgba(15,23,42,0.6);
    box-shadow: 0 0 25px rgba(6,182,212,0.15);
    animation: floatPoster 4s ease-in-out infinite;
  }
  .poster-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform .5s ease;
  }
  .poster::before { content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(from 0deg, #06b6d4 0%, transparent 25%, #7c3aed 50%, transparent 75%, #f472b6 100%); animation: rotateShine 6s linear infinite; opacity: 0.25; border-radius: 50%; pointer-events: none; }


  .poster:hover .poster-img { transform: scale(1.05); }
  @keyframes floatPoster { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-6px); } }
  .poster::after { content: ""; position: absolute; inset: 0; border-radius: inherit; border: 2px solid rgba(124,58,237,0.4); box-shadow: 0 0 25px rgba(124,58,237,0.4); animation: pulseGlow 3s ease-in-out infinite; pointer-events: none; } /* 🌀 Floating poster */ @keyframes floatPoster { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-6px); } } /* 🌈 Rotating shine */ @keyframes rotateShine { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>
</head>
<body>
<div class="wrap">
<header>
  <div class="logo">MS</div>
  <div>
    <h1>AI Song Re-Composer 360°</h1>
    <div class="meta">Upload / Record → Analyze → Generate Remix → Visualize → Download</div>
  </div>
</header>

<div class="grid">
  <!-- Left Column -->
  <div class="card">
    <div class="controls">
      <!-- Custom Upload -->
      <div class="custom-upload">
        <input id="audioFile" type="file" accept="audio/*" />
        <button type="button" id="uploadBtn">📂 Choose File</button>
        <span id="fileName">No file chosen</span>
      </div>

      <!-- Record + Style -->
      <div style="display:flex;gap:8px;align-items:center;margin-top:12px">
        <button id="recordBtn" class="secondary" type="button">🎤 Record Humming</button>
        <div style="flex:1">
          <label for="styleSelect">Choose target style</label>
          <select id="styleSelect">
            <option value="edm">EDM / Electronic</option>
            <option value="rock">Rock</option>
            <option value="classical">Classical / Orchestral</option>
            <option value="folk">Folk / Cultural</option>
            <option value="jazz">Jazz</option>
            <option value="synthwave">Synthwave / Retro-Future</option>
          </select>
        </div>
      </div>

      <div style="display:flex;gap:8px;margin-top:12px">
        <button id="generateBtn">Generate Remix</button>
        <button id="downloadBtn" class="secondary" disabled>Download Remix</button>
      </div>

      <div style="margin-top:12px">
        <label>Analysis (tempo, key, mood)</label>
        <pre id="analysis">No audio yet. Upload or record to analyze.</pre>
      </div>

      <div style="margin-top:12px">
        <label>Player + Visualizer</label>
        <audio id="audioPlayer" controls></audio>
        <canvas id="visualizer"></canvas>
      </div>
    </div>
  </div>

  <!-- Right Column -->
  <div>
    <div class="card lyrics-columns" style="margin-bottom:16px">
      <div>
        <label>CREATOR</label>
        <pre id="realLyrics">Meeravathi.S</pre>
      </div>
      <div>
        <label>AI-generated Lyrics / Notes</label>
        <pre id="aiLyrics">No lyrics yet.</pre>
      </div>
    </div>

    <div class="card" style="margin-bottom:16px">
      <label>AI-generated Poster / Album Art</label>
      <div class="poster"><img id="poster" class="poster-img" src="" alt="Poster preview" /></div>
    </div>

    <div class="card">
      <label>Recent outputs</label>
      <div id="outputs"></div>
    </div>
  </div>
</div>

<footer>Starter UI: connect to backend endpoints (/api/analyze, /api/generate, /api/lyrics)</footer>
</div>

<script>
  const uploadBtn = document.getElementById('uploadBtn');
const audioFileInput = document.getElementById('audioFile');
const fileNameSpan = document.getElementById('fileName');
const audioPlayer = document.getElementById('audioPlayer');
const generateBtn = document.getElementById('generateBtn');
const downloadBtn = document.getElementById('downloadBtn');
const styleSelect = document.getElementById('styleSelect');
const analysisPre = document.getElementById('analysis');
const lyricsPre = document.getElementById('aiLyrics');
const posterImg = document.getElementById('poster');
const outputsBox = document.getElementById('outputs');
const recordBtn = document.getElementById('recordBtn');

let selectedFile, audioContext, analyser, sourceNode, rafId, mediaRecorder, recordedChunks = [];

// --- Upload file ---
uploadBtn.addEventListener('click', () => audioFileInput.click());
audioFileInput.addEventListener('change', async () => {
    const file = audioFileInput.files[0];
    if (!file) return;
    fileNameSpan.textContent = file.name;
    selectedFile = file;
    audioPlayer.src = URL.createObjectURL(file);
    audioPlayer.onplay = () => { if (!audioContext) createVisualizerForMediaElement(audioPlayer); };
    await analyzeAudio(file);
});

// --- Audio visualizer ---
function ensureAudioContext() { if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)(); }
function createVisualizerForMediaElement(mediaElement){
    ensureAudioContext();
    try{ if(sourceNode) sourceNode.disconnect(); } catch(e){}
    sourceNode = audioContext.createMediaElementSource(mediaElement);
    analyser = audioContext.createAnalyser();
    analyser.fftSize = 1024;
    sourceNode.connect(analyser);
    analyser.connect(audioContext.destination);
    drawVisualizer();
}
function drawVisualizer() {
    const canvas = document.getElementById('visualizer');
    const ctx = canvas.getContext('2d');
    const WIDTH = canvas.clientWidth * devicePixelRatio;
    const HEIGHT = 150 * devicePixelRatio;
    canvas.width = WIDTH; canvas.height = HEIGHT;
    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);
    function draw() {
        rafId = requestAnimationFrame(draw);
        analyser.getByteFrequencyData(dataArray);
        ctx.fillStyle = '#031226';
        ctx.fillRect(0,0,WIDTH,HEIGHT);
        let x = 0;
        const barWidth = (WIDTH / bufferLength) * 2.5;
        for(let i=0;i<bufferLength;i++){
            const barHeight = dataArray[i];
            ctx.fillStyle = `rgb(${barHeight+100},50,${255-barHeight})`;
            ctx.fillRect(x, HEIGHT-barHeight/2, barWidth, barHeight/2);
            x += barWidth + 1;
        }
    }
    draw();
}

// --- Audio analysis (dummy, always works) ---
async function analyzeAudio(file){
  const dummyTempos = [90, 100, 110, 120, 130];
  const dummyKeys = ["C", "D", "E", "F", "G", "A", "B"];
  const dummyMoods = ["love", "happy", "sad", "action", "romantic", "devotional"];

  const randomTempo = dummyTempos[Math.floor(Math.random()*dummyTempos.length)];
  const randomKey = dummyKeys[Math.floor(Math.random()*dummyKeys.length)];
  const randomMood = dummyMoods[Math.floor(Math.random()*dummyMoods.length)];

  analysisPre.textContent = `Tempo: ${randomTempo} BPM\nKey: ${randomKey}\nMood: ${randomMood}`;

  await new Promise(resolve => setTimeout(resolve, 500));
}

// --- Fetch Lyrics ---
async function fetchLyrics(songName) {
  try {
      let res = await fetch("https://music-studio-d8pn.onrender.com/api/lyrics", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ song_name: songName })
      });

      let data = await res.json();
      console.log("Lyrics Response:", data);

      // === Update UI ===
      if (data.lyrics) {
          lyricsPre.textContent = data.lyrics;
      } else {
          lyricsPre.textContent = "No lyrics generated.";
      }
  } catch (err) {
      console.error("Error fetching lyrics:", err);
      lyricsPre.textContent = "Error fetching lyrics.";
  }
}

// --- Fetch Poster (placeholder) ---
async function fetchPoster(songName) {
    const randomNum = Math.floor(Math.random()*1000);
    posterImg.src = "https://picsum.photos/300/300?random=" + randomNum;
    posterImg.alt = songName + " Poster";
}

// --- Generate Lyrics & Poster ---
generateBtn.addEventListener('click', async ()=>{
    if(!selectedFile){ alert('Upload audio first'); return; }

    const songName = fileNameSpan.textContent.split('.')[0]; 
    const selectedStyle = styleSelect.value || "vibrant";
    generateBtn.textContent = "Generating...";

    try {
        await fetchLyrics(songName);
        await fetchPoster(songName);

        downloadBtn.disabled = false;
        outputsBox.innerHTML = `<div>Output generated at ${new Date().toLocaleTimeString()}</div>` + outputsBox.innerHTML;

    } catch(e){
        console.error(e);
        alert("Failed to generate output");
    } finally {
        generateBtn.textContent = "Generate Remix";
    }
});

// --- Download button ---
downloadBtn.addEventListener('click', () => {
    const a = document.createElement('a');
    a.href = audioPlayer.src;
    a.download = 'remix.mp3';
    a.click();
});

// --- Record audio ---
recordBtn.addEventListener('click', async ()=>{
    if(!mediaRecorder){
        const stream = await navigator.mediaDevices.getUserMedia({audio:true});
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.ondataavailable = e=>recordedChunks.push(e.data);
        mediaRecorder.onstop = ()=>{ 
            const blob = new Blob(recordedChunks,{type:'audio/mp3'});
            selectedFile = new File([blob],"recorded.mp3",{type:"audio/mp3"});
            audioPlayer.src = URL.createObjectURL(blob);
            recordedChunks = [];
            analyzeAudio(selectedFile);
        };
    }
    if(mediaRecorder.state==="inactive"){ 
        mediaRecorder.start(); 
        recordBtn.textContent="⏹ Stop Recording"; 
    } else { 
        mediaRecorder.stop(); 
        recordBtn.textContent="🎤 Record Humming"; 
    }
});
</script>
</body>
</html>
